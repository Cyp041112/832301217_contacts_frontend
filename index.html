<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的通讯录</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            color: #343a40;
            font-family: "Microsoft YaHei", "Inter", sans-serif;
        }

        .contact-container {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1200px;
        }

        .page-title {
            color: #2d3748;
            font-weight: 600;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 0.8rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .page-title i {
            color: #0d6efd;
        }

        .btn-add {
            background-color: #0d6efd;
            border-color: #0d6efd;
            padding: 0.5rem 1.2rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-add:hover {
            background-color: #0b5ed7;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(13, 110, 253, 0.2);
        }

        .contact-table {
            margin-bottom: 0;
        }

        .contact-table thead {
            background-color: #0d6efd;
            color: #ffffff;
        }

        .contact-table th {
            text-align: center;
            vertical-align: middle;
            padding: 0.8rem 0.5rem;
            font-weight: 500;
        }

        .contact-table td {
            text-align: center;
            vertical-align: middle;
            padding: 0.8rem 0.5rem;
            border-color: #e9ecef;
            transition: background-color 0.2s ease;
        }

        .contact-table tbody tr:hover {
            background-color: #f1f7ff;
        }

        .btn-operation {
            padding: 0.3rem 0.6rem;
            font-size: 0.85rem;
            border-radius: 6px;
        }

        .btn-edit {
            background-color: #ffc107;
            border-color: #ffc107;
            color: #212529;
        }

        .btn-edit:hover {
            background-color: #e0a800;
            border-color: #d39e00;
        }

        .btn-delete {
            background-color: #dc3545;
            border-color: #dc3545;
        }

        .btn-delete:hover {
            background-color: #bb2d3b;
            border-color: #b02a37;
        }

        .empty-tip {
            text-align: center;
            padding: 3rem 1rem;
            color: #6c757d;
        }

        .empty-tip i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #adb5bd;
        }

        @media (max-width: 768px) {
            .contact-container {
                padding: 1.2rem;
                margin: 1rem 0.5rem;
            }

            .page-title {
                font-size: 1.5rem;
                padding-bottom: 0.5rem;
            }

            .col-id {
                display: none;
            }

            .contact-table th,
            .contact-table td {
                padding: 0.6rem 0.3rem;
                font-size: 0.85rem;
            }

            .btn-operation {
                padding: 0.2rem 0.4rem;
                font-size: 0.75rem;
                margin: 0.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="contact-container">
            <h1 class="page-title">
                <i class="bi bi-address-book-fill"></i> 我的通讯录
            </h1>

            <div class="d-flex justify-content-end mb-4">
                <button class="btn btn-add" onclick="window.location.href='add.html'">
                    <i class="bi bi-plus-circle me-2"></i>添加联系人
                </button>
            </div>

            <div class="table-responsive">
                <table class="table table-bordered contact-table">
                    <thead>
                        <tr>
                            <th class="col-id">ID</th>
                            <th>姓名</th>
                            <th>手机号</th>
                            <th>邮箱</th>
                            <th>备注</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="contactTableBody">
                        <!-- 仅保留空数据提示行 -->
                        <tr id="emptyRow" style="display: none;">
                            <td colspan="6" class="empty-tip">
                                <i class="bi bi-folder-x"></i>
                                <p>暂无联系人数据</p>
                                <p class="text-sm">点击"添加联系人"开始创建</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_URL = 'http://localhost:5000/api/contacts';
        const tableBody = document.getElementById('contactTableBody');
        const emptyRow = document.getElementById('emptyRow');

        window.onload = loadContacts;

        async function loadContacts() {
            try {
                // 清空表格内容（保留空数据提示行）
                clearTableContent();
                
                const response = await fetch(API_URL);
                const result = await response.json();

                if (result.status === 'success') {
                    const contacts = result.data;

                    if (contacts.length === 0) {
                        showEmpty();
                        return;
                    }

                    contacts.forEach(contact => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="col-id">${contact.id}</td>
                            <td class="text-nowrap">${formatText(contact.name)}</td>
                            <td class="text-nowrap">${formatText(contact.phone)}</td>
                            <td>${formatText(contact.email)}</td>
                            <td>${formatText(contact.note)}</td>
                            <td class="text-nowrap">
                                <button class="btn btn-operation btn-edit" onclick="goToEdit(${contact.id})">
                                    <i class="bi bi-pencil-fill me-1"></i>修改
                                </button>
                                <button class="btn btn-operation btn-delete" onclick="deleteContact(${contact.id})">
                                    <i class="bi bi-trash-fill me-1"></i>删除
                                </button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    alert(`加载失败：${result.msg || '未知错误'}`);
                    showEmpty();
                }
            } catch (error) {
                console.error('加载错误：', error);
                alert('加载失败，请检查后端是否已启动或网络是否正常！');
                clearTableContent();
                showEmpty();
            }
        }

        function goToEdit(id) {
            window.location.href = `edit.html?id=${id}`;
        }

        async function deleteContact(id) {
            if (!confirm('确定要删除这个联系人吗？删除后无法恢复！')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                const result = await response.json();
                
                alert(result.msg || (result.status === 'success' ? '删除成功！' : '删除失败！'));
                loadContacts();
            } catch (error) {
                alert('删除失败，请重试！');
                console.error('删除错误：', error);
            }
        }

        function formatText(text) {
            return text ? text : '<span class="text-muted">-</span>';
        }

        function showEmpty() {
            emptyRow.style.display = 'table-row';
        }

        function clearTableContent() {
            // 只删除数据行，保留空数据提示行
            const rows = tableBody.querySelectorAll('tr:not(#emptyRow)');
            rows.forEach(row => row.remove());
            emptyRow.style.display = 'none';
        }
    </script>
</body>
</html>